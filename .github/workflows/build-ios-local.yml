# æ­¤å·¥ä½œæµæ˜¯ä¸ºäº†æ„å»ºä¸€ä¸ªimmortalwrtå›ºä»¶çš„å®‰è£…å™¨ æ ¼å¼ä¸ºiso å¯ç”¨äºæ‰€æœ‰çš„è™šæ‹Ÿæœº å’Œ ç‰©ç†æœº
# æ‰€è°“å®‰è£…å™¨å°±æ˜¯ç”¨æ¥å®‰è£…ç”¨çš„ isoå¼•å¯¼çš„æ˜¯ä¸€ä¸ªå¯åŠ¨é€Ÿåº¦æå¿«çš„debian liveç³»ç»Ÿ è·‘ç åè¾“å…¥å‘½ä»¤ ddd å³å¯è°ƒå‡ºå®‰è£…èœå•
# å®‰è£…æ—¶ è‹¥æ˜¯å¤šå¼ ç¡¬ç›˜ ä½ å¯ä»¥é€‰æ‹© éœ€è¦å®‰è£…çš„ç¡¬ç›˜ æ­¤ç±»æ–¹æ³•å®‰è£…çš„openwrt å®‰è£…åæ˜¯æœ‰å‰©ä½™ç©ºé—´çš„ æ›´å¤šä¿¡æ¯è¯·å‚è€ƒ wukongdaily/img-installer é¡¹ç›®
# å‡ ä¹æ‰€æœ‰linux éƒ½æœ‰å„è‡ªçš„å®‰è£…å™¨ å”¯ç‹¬openwrtå’Œarmbian æ²¡æœ‰, å¸Œæœ›æ­¤å·¥ä½œæµ å¼¥è¡¥è¿™ä¸ªé—æ†¾ è®©ä½ æ›´ä¼˜é›…çš„ å®‰è£…openwrt 

name: build ISO To Location

on:
  workflow_dispatch:
    inputs:
      imgFile:
        description: 'è¯·è¾“å…¥è¦ç¼–è¯‘å›ºä»¶çš„ä¸‹è½½é“¾æ¥'
        required: true
        default: 'https://xxx'

jobs:
  build_installer_iso:
    runs-on: ubuntu-22.04
    needs: build_immortalwrt
    env:
      GITHUB_ACTIONS_RUNNER_DISK: 30GB  # è¯·æ±‚å¤§å®¹é‡è¿è¡Œå™¨

    steps:
      - name: Download firmware artifact
        uses: actions/download-artifact@v4
        with:
          name: firmware-img

      - name: â¬ åŒæ­¥ img-installer é¡¹ç›® å‡†å¤‡åˆ¶ä½œISO
        run: |
          git clone https://github.com/wukongdaily/img-installer.git
          cd img-installer

      - name: Set executable permissions for scripts
        run: |
          chmod +x "${{ github.workspace }}/img-installer/custom.sh"
          chmod +x "${{ github.workspace }}/img-installer/supportFiles/custom/build.sh"

      - name: âœ… åˆ¶ä½œ ISO
        run: |
          cd img-installer
          wget "${{ github.event.inputs.imgFile }}"
          firmware_file=$(ls *squashfs-combined-efi.img.gz)
          bash autobuild/autobuild.sh "../$firmware_file"

      - name: ğŸš€ ä¸Šä¼  ISO åˆ° Release
        uses: softprops/action-gh-release@v2.2.1
        with:
          tag_name: "Custom-Installer-x86_64-ISO"
          body_path: "${{ github.workspace }}/img-installer/autobuild/info.md"
          files: |
            img-installer/output/custom-installer-x86_64.iso
          token: "${{ secrets.GITHUB_TOKEN }}"
